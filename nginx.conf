server {
    listen 80;
    
    # [FIX QUAN TRỌNG] Tắt sendfile để tránh lỗi serve file tĩnh (CSS/JS bị 0 bytes hoặc lỗi) trên Docker Windows/VM
    sendfile off;
    
    # [QUAN TRỌNG] Bắt buộc load mime.types để trình duyệt hiểu CSS là CSS, JS là JS
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    root /usr/share/nginx/html;
    index index.html;

    # Cấu hình cho file JSON (để load config)
    location ~ \.json$ {
        add_header Cache-Control "no-cache";
        add_header Access-Control-Allow-Origin *;
    }

    # Cấu hình cho CSS/JS/Images
    # Regex này bắt tất cả các đuôi file tĩnh
    location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$ {
        # Nếu không thấy file, trả về 404 ngay lập tức (tránh fallback về index.html gây lỗi cú pháp CSS)
        try_files $uri =404;
        
        expires 1y;
        add_header Cache-Control "public, no-transform";
    }

    # Cấu hình cho React Router (SPA)
    location / {
        try_files $uri $uri/ /index.html;
    }
}